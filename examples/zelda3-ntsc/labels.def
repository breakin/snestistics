function 008000 0080C6 entry breakin
# This is the main game loop that executes once per frame
function 008034 0080C8 gameloop breakin
# Reads Y = $10 (state)
; Jump [$8061+Y $807D+Y $8099+Y].
; $00: Intro
; $01: Select player
; $02: Copy player
; $03: Erase player
; $05: When starting game, after chosen a player
; $07: Inside house / castle?
; $08: While loading new screen/room
; $09: Outside (at least in the beginning of the game)
; $0E: Modal message text shown
; $0F: Something when loading new room
; $12: Death screen
function 0080B5 0080B5 gameloop_dispatcher breakin
# Invoked by NMI
function 0080C9 00822C vblank_nmi breakin
function 00814C 0081FF initialize_perframe_graphics_registersB breakin
# Called from VBLANK
function 00822D 0082D7 initialize_perframe_graphics_registersA breakin
# Invoked by IRQ
function 0082D8 008332 unknown_irq_1 breakin
function 008333 0083D0 unknown33 breakin
function 0083D1 0083F8 readJoypad breakin
# Initialize RAM $0861-$0A00 with [F0 00 00 00] (416 bytes, 104 entries?)
function 00841E 008489 initMemory_at0861_to_F0000000 breakin
function 0085FC 008780 unknown36 breakin
# Called using JSL so PC after JML is on the stack. Pops it manually and don't RET. Keeps X,Y.
; Jumps to [RET + (A&0x00FF)*2] (support 2 bytes adresses, same PB as calling function)
function 008781 008781 jumpEncodedWordJump breakin
# Called using JSL so PC after JML is on the stack. Pops it manually and don't RET. Keeps X,Y.
; Jumps to [RET + (A&0x00FF)*3] (support full 3 bytes adresses)
function 00879C 00879C jumpEncodedLongJump breakin
# Zero Memory (Entire $0000-$1fff)
; Zero $7EC500 (2b)
; Zero $701FFE (2b)
; If $70:03E5==$55AA, let it be. Otherwise zero (2b). (true)
; If $70:08E5==$55AA, let it be. Otherwise zero (2b). (false)
; If $70:0DE5==$55AA, let it be. Otherwise zero (2b). (false)
; $212E=0 (2b)
; [00:0013] = $80
; [00:0015]++
function 0087C0 00882D zeroMemory1 breakin
function 008888 0088EC audio_unknown0 breakin
# [00:0000-0002]=$008019
function 008901 008912 audio_unknown0_008019 breakin
function 008913 008924 audio_unknown0_F59E1A breakin
function 00891D 00891D audio_unknown0_trampoline breakin
function 008925 008931 audio_unknown0_00801B breakin
function 00893D 008949 unknown30 breakin
function 0089E0 0089EC unknown71 breakin
function 0089EF 008CE3 unknown72 breakin
function 008F45 008F71 unknown37 breakin
function 009347 00937A unknown38 breakin
function 00C2F0 00C2F0 gameloop_Y14_backstory breakin
function 00D231 00D2BD unknown73 breakin
function 00D2C8 00D2FF unknown8 breakin
function 00D308 00D336 unknown3 breakin
function 00D337 00D361 unknown4 breakin
function 00D3C6 00D406 unknown5 breakin
function 00D423 00D468 unknown74 breakin
# Unpack directly from tableA, data is uncompressed. Entry specified through memory 00:0000
function 00D537 00D537 unpack_tableA_index000000 breakin
function 00D54E 00D54E decompress_and_unpack_image_tableA breakin
function 00D553 00D553 unpack_image_source7f4000 breakin
function 00D561 00D561 unpack_image breakin
function 00D5CE 00D6DB unpack_image2_inner breakin
function 00D61C 00D667 unpack_image_inner breakin
function 00E19B 00E2CF unknown75 breakin
function 00E2D0 00E30A unknown1 breakin
function 00E33B 00E33B decompressTableA_AndCopy2048_2118 breakin
function 00E33E 00E33E copy2048_to_vram_2118 breakin
function 00E343 00E36C unknown76 breakin
function 00E384 00E398 unknown39 breakin
function 00E3FA 00E4E8 unknown40 breakin
function 00E4E9 00E555 unknown54 breakin
function 00E583 00E5AC unknown41 breakin
function 00E5AF 00E608 unknown55 breakin
function 00E609 00E633 unknown56 breakin
function 00E636 00E6B6 unknown57 breakin
function 00E6B7 00E741 unknown58 breakin
function 00E744 00E759 unknown59 breakin
function 00E75C 00E75C decompress_tableA_dest7f4600_indexY breakin
function 00E766 00E766 decompress_tableA_dest7f4000_indexY breakin
function 00E76E 00E76E decompress_tableA_nodest_indexY breakin
function 00E772 00E772 decompress_tableA_something breakin
function 00E783 00E783 decompressTableB_indexY breakin
function 00E78F 00E78F decompress_tableB_something breakin
# Decompression routine
function 00E79E 00E851 decompress breakin
function 00E7A3 00E7A3 decompress_main breakin
function 00E7AD 00E7AD decompress_getcodelen breakin
function 00E7BF 00E7BF decompress_getlongcount breakin
function 00E7D1 00E7D1 decompress_notlongcount breakin
function 00E7E1 00E7E1 decompress_repeat_single_incrementing breakin
function 00E7EF 00E7EF decompress_transfer_source breakin
function 00E7FE 00E7FE decompress_repeat_single breakin
function 00E80B 00E80B decompress_repeat_alt breakin
function 00E825 00E825 decompress_transfer_dest breakin
function 00E843 00E843 decompress_readsourcebyte breakin
function 00E90C 00E9CB unknown60 breakin
function 00F800 00F875 gameloop_displayModalText breakin
function 00FC41 00FC84 unknown7 breakin
function 028000 028053 unknown77 breakin
function 028116 02811D unknown78 breakin
# Activated once a player was selected from menus
; Does a bunch of stuff, can switch to game state $7
function 028136 0281BC gameloop_hm breakin
# Activated once a player was selected from menus
function 0281ED 028207 gameloop_hm2 breakin
# Activated when leaving links house
function 0283BF 0283C6 gameloop_hm3 breakin
function 02854C 028569 unknown79 breakin
function 0287A2 0288C0 gameloop_gameInsideHouseOrCastle breakin
function 02A475 02A52C gameloop_gameOutside breakin
function 02C500 02C532 unknown26 breakin
function 02C57B 02C5B1 unknown2 breakin
function 02C5B2 02C62F unknown25 breakin
function 02C630 02C68B unknown6 breakin
function 02C692 02C6EA unknown12 breakin
function 02C769 02C7B7 unknown15 breakin
function 02D8B3 02DB6D unknown23 breakin
function 02DC55 02DD87 unknown42 breakin
function 02E4A3 02E5D3 unknown43 breakin
function 07F13C 07F1A2 unknown9 breakin
# TODO: Double check this, I'm unclear on MVN srblk,dstblk
; Set [00:1F00-00:1F01]=0
; Move memory down from 001F02-001FFF to 001F00-001FFD (253 bytes). Copy 001F31 to 001F0A.
; Move memory down from 001F32-001F3E to 09F810-09F81C.
function 09F7DE 09F7DE copyMemorySomething3 breakin
function 09F81D 09F83B unknown80 breakin
function 09F83D 09F863 unknown81 breakin
function 09F864 09F8FA unknown82 breakin
function 09F8FB 09F930 unknown83 breakin
function 09F931 09F9D5 unknown84 breakin
function 09F9D6 09FA4E unknown85 breakin
# Too big?
function 09FA4F 09FB23 unknown86 breakin
function 09FB24 09FB6C unknown87 breakin
function 09FCAE 09FCC3 unknown88 breakin
function 09FD04 09FD1D unknown89 breakin
function 09FDCF 09FE93 unknown116 breakin
function 09FEB4 09FF1D unknown115 breakin
function 09FF1E 09FF8B unknown114 breakin
function 0C0001 0C0001 stateA_mutate23 breakin
function 0C005F 0C005F stateA_mutate18 breakin
function 0C00C8 0C00C8 stateA_mutate20 breakin
function 0C00E6 0C00E6 stateA_mutate19 breakin
function 0C5830 0C5830 stateA_mutate28 breakin
function 0C5875 0C5875 stateA_mutate27 breakin
function 0C5F4B 0C5F4B stateA_mutate26 breakin
# Loads sub state from $7E0011 into A
; If A==8 it checks for keypresses (using $F6) and might quit the intro
; $00
; $01 Nintendo presents (fading out)
; $02
; $03 1991,1992 Nintendo
; $04 Triforce animation
; $05 Fade in zelda logo
; $06 Animated sword down into logo, flashing colors
; $07 Fade in sea in background
; $08 Show sword and lake
function 0CC120 0CC15C gameloop_Y0_intro breakin
comment 0CC122 "Check if user pressed a key ($F6), if so do something (?)"
comment 0CC133 "Load current intro state from $00:0011 into A"
comment 0CC135 "Jump to function indexed by the game state"
ptr24 0CC139 0CC15C TODO_GIVENAME breakin
function 0CC15D 0CC17B gameloop_intro_A0_unknown0 breakin
function 0CC170 0CC19F gameloop_intro_A1_nintendo_presents breakin
ptr24 0CC17F 0CC19F TODO_GIVENAME breakin
function 0CC1A0 0CC1F4 unknown111 breakin
function 0CC1F5 0CC25B unknown110 breakin
function 0CC25C 0CC283 gameloop_intro_A5_fadeinzeldalogo breakin
function 0CC284 0CC2AD gameloop_intro_A7_fade_in_sea breakin
function 0CC2AE 0CC2D3 gameloop_intro_A6_sword_going_down breakin
# Used in gameloop_intro for something
function 0CC33C 0CC36E gameloop_intro_A2_AA_unknown breakin
function 0CC36F 0CC3BC unknown108 breakin
# Copy 16 bytes from 0CC425 to 7EC6A0 and increase $15
function 0CC3BD 0CC403 memcpy_0CC425_7EC6A0_16_increase000015 breakin
# Used in gameloop_intro to present "1991,1992 Nintendo"
; Used in gameloop_intro to show the triforce animation"
function 0CC404 0CC411 unknown107 breakin
# Invokes stateA-machine through stateA_mutate1 (8 times)
; X=7,6,5,4,3,2,1,0
; [00:1E08]=$00
; [00:1E09]=$08
function 0CC412 0CC424 unknown106 breakin
function 0CC435 0CC447 unknown105 breakin
function 0CC448 0CC45A unknown104 breakin
ptr16 0CC44F 0CC45A TODO_GIVENAME breakin
function 0CC45B 0CC47A unknown103 breakin
function 0CC47B 0CC4B9 unknown102 breakin
# Reads A from 0C:1E17+X and jump using jumpEncodedWordJump
; A=0 => stateA_mutate5
; A=1 => stateA_mutate2
; A=2 => stateA_mutate3
function 0CC534 0CC539 stateA_mutate1 breakin
# Quit the state machine, RTS!
function 0CC543 0CC543 stateA_mutate5 breakin
# Read A from 0C:1E18+X and jump using jumpEncodedWordJump
; A=0 => stateA_mutate8
; A=1 => stateA_mutate10
; A=2 => stateA_mutate4
; A=3 => stateA_mutate11
; A=4 => stateA_mutate12
; A=5 => stateA_mutate12
; A=6 => stateA_mutate12
; A=7 => stateA_mutate13
function 0CC544 0CC547 stateA_mutate2 breakin
# Reads A from 0C:1E18+X
; A=0 => stateA_mutate6
; A=1 => stateA_mutate10
; A=2 => stateA_mutate9
; A=3 => stateA_mutate14
; A=4 => stateA_mutate15
; A=5 => stateA_mutate15
; A=6 => stateA_mutate15
; A=7 => stateA_mutate16
; A=8 => stateA_mutate17
; A=9 => stateA_mutate18
; A=A => stateA_mutate19
; A=B => stateA_mutate20
; A=C => stateA_mutate21
; A=D => stateA_mutate20
function 0CC55B 0CC55E stateA_mutate3 breakin
function 0CC57E 0CC5B0 stateA_mutate8 breakin
# Call unknown95 then unknown90
; A = [00:1E00] (1 byte)
; A=0 => stateA_mutate7 
; A=1 => stateA_mutate7 
; A=2 => stateA_mutate7 
; A=3 => stateA_mutate7 
; A=4 => stateA_mutate7 
; A=5 => stateA_mutate22 
; A=6 => stateA_mutate24 
; A=7 => stateA_mutate24  
; A=8 => stateA_mutate25  
; A=9 => stateA_mutate26  
; A=A => stateA_mutate27  
; A=B => stateA_mutate28 
function 0CC5B1 0CC5BA stateA_mutate6 breakin
# Do stuff, quit state machine
function 0CC5D6 0CC607 stateA_mutate7 breakin
function 0CC608 0CC608 stateA_mutate22 breakin
function 0CC70F 0CC72E unknown95 breakin
function 0CC84F 0CC84F stateA_mutate10 breakin
# Quits state matchine, updates memory
; [$1E30+X]=$4C
; [$1E38+X]=$00
; [$1E48+X]=$B8
; [$1E50+X]=$00
; [$1E10+X]++
function 0CC850 0CC863 stateA_mutate4 breakin
# Call unknown92, then quit state machine
function 0CC864 0CC867 stateA_mutate9 breakin
function 0CC8D0 0CC8E1 unknown92 breakin
function 0CC8E2 0CC8E2 stateA_mutate11 breakin
function 0CC90D 0CC90D stateA_mutate14 breakin
function 0CC972 0CC9F0 unknown91 breakin
function 0CC9F1 0CCA4B unknown90 breakin
function 0CCBE8 0CCBE8 stateA_mutate12 breakin
function 0CCC13 0CCC13 stateA_mutate15 breakin
function 0CCD19 0CCD19 stateA_mutate13 breakin
function 0CCD3E 0CCD3E stateA_mutate16 breakin
function 0CED82 0CEDAC unknown24 breakin
function 0CFF01 0CFF01 stateA_mutate25 breakin
function 0CFFBD 0CFFBD stateA_mutate21 breakin
function 0CFFDA 0CFFDA stateA_mutate17 breakin
function 0CFFFF 0CFFFF stateA_mutate24 breakin
function 0DB818 0DB857 unknown11 breakin
# Clearing a lot of memory 0CE2-0F00, writin to 7FFA1C
function 0DB871 0DB871 clearMemory_indexX_andMemory000000 breakin
function 0E97D9 0E97DD memcpy_7EFE02_0E965B_372 breakin
# X = 62, 60, ..., 2 (not 0). 31 iterations.
; 6*2=12 bytes copied per iteration
function 0ED3EB 0ED442 copyStuff1 breakin
function 0ED5F4 0ED617 unknown22 breakin
function 1BC980 1BC983 unknown69 breakin
function 1BC983 1BC983 unknown70 breakin
function 1BCA69 1BCA9E unknown68 breakin
function 1BEC77 1BEC9D unknown21 breakin
function 1BEC9E 1BECC4 unknown20 breakin
function 1BECC5 1BECE3 unknown67 breakin
function 1BECE4 1BED02 unknown66 breakin
function 1BED03 1BED28 unknown65 breakin
function 1BED29 1BED4E unknown64 breakin
function 1BED6E 1BED90 unknown62 breakin
function 1BED72 1BED90 unknown19 breakin
function 1BED91 1BEDDC unknown63 breakin
function 1BEDF9 1BEE39 unknown44 breakin
function 1BEE52 1BEE73 unknown18 breakin
function 1BEE74 1BEEA7 unknown61 breakin
function 1BEEA8 1BEEC6 unknown17 breakin
function 1BEEC7 1BEEE7 unknown16 breakin
function 1BEEE8 1BEF0B unknown14 breakin
function 1BEF0C 1BEF2F unknown13 breakin
# Copy stuff to 7EC300 (TODO: Check more!)
function 1BEF30 1BEF3B copyDataTo7EC300_variantB breakin
# Copy stuff to 7EC300 (TODO: Check more!)
function 1BEF4B 1BEF5F copyDataTo7EC300_variantA breakin
function 1BEF96 1BF031 unknown53 breakin
function 1BF032 1BF071 unknown52 breakin
function 1BF072 1BF099 unknown51 breakin
function 1BF09A 1BF0C1 unknown50 breakin
function 1DE9B6 1DE9D9 unknown49 breakin
function 1DE9DA 1DE9FB unknown48 breakin
function 1DE9FC 1DE9FF unknown47 breakin
function 1DEA00 1DEB67 unknown46 breakin
function 1DF65D 1DF6B3 unknown10 breakin
function 1EFF8D 1EFFDD unknown45 breakin
# Game state
data 7E0010 7E0010 RAM_GAMESTATE breakin
# Game sub state
data 7E0011 7E0011 RAM_GAMESUBSTATE breakin
# Communicate between vblank and game loop
data 7E0012 7E0012 RAM_VBLANKNMICOM breakin
# Frame Counter
data 7E001A 7E001A RAM_FRAMECOUNT mathonnapkin
# In a building
; Flag is set to 1 if you are in a building. Set to 0 otherwise. (Credit: Euclid)
data 7E001B 7E001B RAM_INBUILDING Euclid
# Main Screen Designation ($212C)
data 7E001C 7E001C RAM_MAINSCREENDES mathonnapkin
# Link’s Y-Coordinate (mirrored at $0FC4)
data 7E0020 7E0021 RAM_LINK_Y mathonnapkin
# Link’s X-Coordinate (mirrored at $0FC2)
data 7E0022 7E0023 RAM_LINK_X mathonnapkin
# Link Z coordinate when elevated
; 0xFFFF usually, but if Link is elevated off the ground it is considered to be his Z coordinate i.e. it's his height off of the ground
data 7E0024 7E0025 RAM_LINKELEVATION mathonnapkin
# BG1 horizontal scroll register ($210F)
data 7E00E0 7E00E1 RAM_BG1_HSCROLL mathonnapkin
# BG2 horizontal scroll register ($210D)
data 7E00E2 7E00E3 RAM_BG2_HSCROLL mathonnapkin
# BG3 horizontal scroll register ($2111)
data 7E00E4 7E00E5 RAM_BG3_HSCROLL mathonnapkin
# BG1 Vertical scroll register ($2110)
data 7E00E6 7E00E7 RAM_BG1_VSCROLL mathonnapkin
# BG2 horizontal scroll register ($210E)
data 7E00E8 7E00E9 RAM_BG2_VSCROLL mathonnapkin
# BG3 horizontal scroll register ($2112)
data 7E00EA 7E00EB RAM_BG3_VSCROLL mathonnapkin
# On upper level?
; In dungeons, 0 Means you’re on the upper level. 1 Means you’re on a lower level. Important for interaction with different tile types.
data 7E00EE 7E00EE RAM_UPPER_LEVEL mathonnapkin
# Joypad something 1
data 7E00F0 7E00F0 JOYPAD1 breakin
# Joypad something 2
data 7E00F4 7E00F4 JOYPAD2 breakin
# Joypad something 3
data 7E00F6 7E00F6 JOYPAD3 breakin
# Joypad something 4
data 7E00F8 7E00F8 JOYPAD4 breakin
# Joypad something 5
data 7E00FA 7E00FA JOYPAD5 breakin
